<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="MYPAGE">
 
 	<!-- 비밀번호 일치 확인 -->
 	<select id="selectPwCheck" resultType="int">
 		select count(*)
 		from tb_user
 		where userId = #{userId} and uPw = #{uPw } and UISLEAVE = 0
 	</select>
 	
 	<!-- 개인정보 수정 -->
 	<update id="updateUser">
 		update tb_user
 		set uNick = #{uNick }, uMail = #{uMail},
 			uPw = #{uPw }, uPhone = #{uPhone}
 		where userId = #{userId } and UISLEAVE = 0
 	</update>
 	
 	<!-- 회원정보 조회 -->
 	<select id="getUserInfo" resultType="USER">
 		select * 
 		from tb_user
 		where uno = #{uNo } and UISLEAVE = 0
 	</select>
 	
 	
 	<!-- 프로필 이미지 조회 -->
 	<select id="selectUserImg" resultType="USERFILE">
 		select * from tb_userFile
 		where ufuno = #{uNo} and UFISDEL = 0
 	</select>
 	
 	<insert id="insertUserImg">
 		insert into tb_userFile(ufuno, uforiginfilename, ufstoredfilename, ufsize, ufsavepath, ufisdel)
		values (#{uNo }, #{ufOriginFileName }, #{ufStoredFileName }, 6, #{ufSavePath }, 0)
 	</insert>
 	
 	<!-- 프로필 이미지 수정 -->
 	<update id="updateUserImg" >
 		update tb_userFile
 		set uforiginfilename = #{ufOriginFileName }
 			, ufstoredfilename = #{ufStoredFileName }
 		where ufuno = #{uNo }
 	</update>
 	
 	<!-- 원본 프로필이미지로 변경(프로필 삭제) -->
 	<delete id="deleteProfileImg">
 		 delete from tb_userFile
 		 where ufuno = #{uNo }
 	</delete>
 	
 	<!-- 함께해요 찜목록 조회 -->
 	<select id="selectLikelist" resultType="Map">
 		select BOARD.dbno, BOARD.dbtitle, IMG.distoredimgname 
 		from tb_doboard BOARD 
 		left join tb_doimg IMG 
 			on BOARD.dbno = IMG.didbno 
 		where dbno IN (select dldbno from tb_dolike where dluno=#{uNo}  and DBISDEL = 0) 
 		order by BOARD.dbno
 	</select>
 	
 	<!-- 함께해요 찜목록 삭제 -->
 	<delete id="deleteDoLike">
 		delete from tb_dolike
 		where dluno = #{uNo } and dldbno = #{dbNo }
 	</delete>
 	
 	<!-- 함께가요 게시글 수 카운트 -->
 	<select id="selectGbContentCnt" resultType="int">
 		select count(*) FROM tb_golike
      	where gluno=#{uNo}
 	</select>
 	
 	<!-- 함께가요 찜목록 조회 -->
	<select id="selectGoLikeList" resultType="Map">
		select *
		from (
    		select rownum rnum, n1.*
    		from(
        		select BOARD.gbno, BOARD.gbuno, U.userId, BOARD.gbtitle, BOARD.gbwrittendate
        		from tb_goboard BOARD join tb_user U on BOARD.gbuno = U.uno
        		where gbno IN (select glgbno from tb_golike where gluno=#{uNo } and GBISDEL = 0)
    		)n1
		)
		where rnum BETWEEN  #{p.start} AND #{p.end}
	</select>
	
	<!-- 함께가요 찜목록 삭제 -->
 	<delete id="deleteGoLike">
 		delete from tb_golike
		where gluno = #{glUNo } and glgbno = #{glGbNo }
 	</delete>


 </mapper>   
 
 
 
 
 